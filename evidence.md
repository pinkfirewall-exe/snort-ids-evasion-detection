# Evidence

---

## Packet Fragmentation<br>
IP fragmentation occurs when a packet is too large to traverse a network path and must be broken into smaller pieces. While fragmentation itself is legitimate, attackers manipulate it to hide malicious content in fragments that an IDS may not properly reassemble<br><br>

---


![packet fragmentation command](https://github.com/user-attachments/assets/163f4a7d-5216-4a66-950a-0c3f3a60884a)

*Figure 1 -  Packet fragmentation command.*<br>
The -f flag forces Nmap to break packets into tiny IP fragments, usually 8-byte chunks.<br><br>


![packet fragmentation before](https://github.com/user-attachments/assets/6b8b2f04-4cf2-4e3a-a40f-c83eddb0c259)

*Figure 2 - Packet fragmentation before rule implementation.*<br>
When I executed the fragmented scan with no custom rules present, Snort remained completely silent. Even though packet captures confirmed that fragments were arriving, Snort treated them as normal because there were no rules referencing fragment offsets. This showed very clearly how dependent Snort is on explicit signatures. Snort did not raise any alert during this phase because, without an explicit rule referencing fragment offsets, the engine treats fragmented packets as normal traffic. Although the frag3 preprocessor correctly reassembles fragments, it does not generate alerts unless supported by detection logic.<br><br>


To surface fragmented packets in alerts, I added:<br>
![packet fragmentation rule](https://github.com/user-attachments/assets/b55adaca-4143-46a9-93db-ed51b6f4afc6)

*Figure 3 - Packet fragmentation rule.*<br>
The fragoffset:>0 tells Snort to alert whenever a packet is not the first fragment. This detects attempts to hide a malicious payload in later fragment segments. The custom message clearly identifies the evasion attempt.<br><br>



![packet fragmentation after](https://github.com/user-attachments/assets/b2004a84-984c-4127-aa2e-26528699330a)

*Figure 4 - Packet fragmentation after rule implementation.*<br>
After enabling this rule, Snort started generating alerts for each fragmented packet as soon as I re-ran the scan. This validated that the rule successfully exposed behaviour that Snort previously ignored.<br>

---

## Overlapping Fragmentation<br>
Overlapping fragmentation is a more advanced evasion strategy where fragments are crafted so that the byte ranges overlap. If the IDS and the receiving host interpret these overlaps differently, the attacker can “hide” malicious content from the IDS while still allowing the target system to reconstruct the harmful payload.<br><br>

![overlapping fragmentation command](https://github.com/user-attachments/assets/225e13ca-5e8c-4bec-9a56-2cc98ba500db)

*Figure 5 - Overlapping fragmentation command.*<br>
Since generating precise overlapping fragments requires custom packet crafting, I simulated the behaviour using Nmap’s ability to produce excessively small fragments.<br>
Setting a very low MTU value forces packets to be split into numerous fragments, which can stress the IDS’s reassembly logic and resemble overlapping or disordered fragment behaviour.<br><br><br>

![overlapping fragmentation before](https://github.com/user-attachments/assets/416af136-d530-495a-8179-a2b5d7f339dd)

*Figure 6 - Overlapping fragmentation before rule implementation.*<br>
When I ran this scan before adding any rules, Snort showed no alerts whatsoever. While the frag3 preprocessor undoubtedly processed the fragments and may have noted anomalies internally, these observations were not surfaced because Snort will only generate an alert when a rule instructs it to do so.<br><br>

To bring suspicious fragment behaviour into view, I created the following rule:
![overlapping fragmentation rule](https://github.com/user-attachments/assets/ab9e2b9f-999d-4c69-a066-ce766a81e76d)

*Figure 7 - Overlapping fragmentation rule.*<br>

This rule identifies fragments that have the More Fragments (MF) flag set and contain extremely small payloads (less than 24 bytes).<br><br>



![overlapping fragmentation after](https://github.com/user-attachments/assets/820fcab4-49b5-44e3-8c26-73a9f6174556)

*Figure 8 - Overlapping fragmentation after rule implementation.*<br>
After reloading Snort with the new rule, the overlapping fragmentation simulation produced many alerts in the console. The rule successfully captured the unusual fragment sizes generated by Nmap's forced fragmentation.<br><br>


---

## Decoy Scanning<br>
Decoy scanning complicates attribution by mixing traffic from multiple spoofed IP addresses alongside the real attacker. Decoy scanning complicates attribution because the IDS sees multiple spoofed IP sources, making it difficult to determine which host initiated the reconnaissance, thereby reducing confidence in the alert data.<br><br>

![decoy scanning command](https://github.com/user-attachments/assets/e41b26b7-19b9-42d5-bcce-ca51a892a41f)

*Figure 9 - Command for decoy scanning.*<br>
This instructs Nmap to include five fake IP addresses as “decoys,” all of which appear in the packet headers as potential scanning sources. For an IDS, this means it becomes difficult to determine which IP is performing reconnaissance.<br>
This makes the victim think multiple hosts (decoys) are scanning it while masking the attacker’s real IP. It confuses the IDS because:
-	Multiple source IP addresses appear simultaneously.
-	It becomes unclear which one is the true attacker.


![decoy scanning before](https://github.com/user-attachments/assets/7659d99f-598c-4684-9d48-c6097f5f446a)

*Figure 10 - Decoy scanning before rule.*<br>
Before creating any rule, Snort showed no sign of detecting the decoy scan. Even though numerous SYN packets were directed at the IDS VM, Snort did not recognize the pattern as suspicious because no scan-related rules were active, and Snort’s built-in logic does not automatically correlate multi-source SYN bursts without a rule telling it how.<br><br>



![decoy scanning rule](https://github.com/user-attachments/assets/5a6b07ce-404d-4ff6-aaa4-ee991738079c)

*Figure 11 - Decoy scanning rule.*<br>
To counter this, I shifted perspective from “tracking by source” to “tracking by target.” I wrote the above rule<br>
- It only looks for SYN packets (flags:S).
- It counts how many SYN packets hit the same destination in a given time window.
- If more than 30 arrive within five seconds, the rule triggers.<br><br>



![decoy scanning after](https://github.com/user-attachments/assets/78c392be-3871-4149-afe1-d7dd0e340234)

*Figure 12 - Decoy scanning after rule.*<br>
Once the rule was loaded, the decoy scan immediately triggered alerts. Snort accurately detected the SYN burst pattern, even though it could not distinguish the true attacker from the decoys, which is expected.<br>


---















